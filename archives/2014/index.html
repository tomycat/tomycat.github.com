<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Archives: 2014 | jinwei&#39;s weblog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="jinwei's weblog">
<meta property="og:url" content="http://tomycat.github.io/archives/2014/">
<meta property="og:site_name" content="jinwei's weblog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jinwei's weblog">
<meta name="twitter:description">

  
    <link rel="alternative" href="/atom.xml" title="jinwei&#39;s weblog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">jinwei&#39;s weblog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://tomycat.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-testmd" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/20/testmd/" class="article-date">
  <time datetime="2014-07-20T01:59:42.000Z" itemprop="datePublished">7月 20 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/20/testmd/">test.md</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>测试</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://tomycat.github.io/2014/07/20/testmd/" data-id="khuzch2q4vs9go0l" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="default-2013-10-27-temple-intro" class="article article-type-default" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/19/2013-10-27-temple-intro/" class="article-date">
  <time datetime="2014-07-19T12:18:44.000Z" itemprop="datePublished">7月 19 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/19/2013-10-27-temple-intro/">前端模板引擎Temple简介</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Features">Features</h3>
<ul>
<li>语法继承自KISSY 1.2 Template ,不过少了个花括号</li>
<li>编译后的代码非常直观 <a href="http://tomycat.github.io/blog/temple/index.html" target="_blank" rel="external">Temple编译后的代码</a> </li>
<li>基本的 if/elseif/else each</li>
<li>include 子模板</li>
<li>extend 模板继承</li>
<li>if(exp) exp可以为复杂表达式</li>
<li>模板允许使用自定义函数</li>
</ul>
<h3 id="Getting_Started">Getting Started</h3>
<pre><code class="javascript">KISSY.use('gallery/temple/1.0/index', function (S, Temple) {
     Temple.add("base","this is head , my sex is {#block name} female {/block}!");
     var temple = Temple.compile('{#extend base} {#block name} {sex} {/block}');
     var html = temple.render({"sex":"male"});
     console.log(html);
})</code></pre>

<h3 id="API">API</h3>
<ul>
<li><code>Temple.compile</code> 将模板编译为可以直接执行的js函数，返回的对象具有render方法</li>
<li><code>Temple.to_js</code> 将模板编译为js代码字符串,用于调试或者预编译</li>
</ul>
<h3 id="语法示例">语法示例</h3>
<h4 id="expression_and_variable">expression and variable</h4>
<pre><code class="javascript">
var s = '{#if (a+(b-c*d/(ef%3)))}'
          + 'blah blah {lib}'
      + '{/if}';
var temple = Temple.compile(s);

temple.render({a:1,b:2,c:3,d:4,ef:5,lib:"KISSY"});
// => "blah blah KISSY"
</code></pre>

<h4 id="if">if</h4>
<pre><code class="javascript">
var template = '{#if name}'
                 + 'hi {name}'
             + '{/if}'

var temple = Temple.compile(template);
temple.render({name:"tom"});
// -> tom
</code></pre>

<h4 id="if/else">if/else</h4>
<pre><code class="javascript">
var template;
template = '{#if name}'
             + '{name}'
         + '{#else}'
             + 'noname'
         + '{/if}'
var temple = Temple.compile(template);
template.render({name:"tom"});
</code></pre>

<h4 id="if/elseif/else">if/elseif/else</h4>
<pre><code class="javascript">
template = '{#if name}'
             + '{name}'
         + '{#elseif sex}'
             + '{sex}'
         + '{#else}'
           + 'oops'
         + '{/if}'
var temple = Temple.compile(template);
temple.render({name:"tom"});
// => tom
</code></pre>

<h4 id="each">each</h4>
<pre><code class="javascript">
 var template =  '{#each items as item index}'
                   + '{index} : {item.name}'
               + '{/each}';

var temple = Temple.compile(template);

temple.render({items:[{name:"john"}]});
// => "0 : john"
</code></pre>

<h4 id="include">include</h4>
<pre><code class="javascript">
Temple.add("head","&lt;h1&gt;共用头&lt;/h1&gt;");
Temple.add("foot","&lt;h1&gt;共用脚&lt;/h1");

var template = '{#include head}'
             + '&lt;p&gt;身体是你自己的&lt;/p&gt;'
             + '{#include foot}';
var temple = Temple.compile(template);
temple.render();
// =&gt; "&lt;h1&gt;共用头&lt;/h1&gt;&lt;p&gt;身体是你自己的&lt;/p&gt;&lt;h1&gt;共用脚&lt;/h1"
</code></pre>

<h4 id="extend">extend</h4>
<pre><code class="javascript">
Temple.add("base","&lt;h1&gt;共用头&lt;/h1&gt;"
                  + "{#block body}"
                    + "&lt;p&gt;大家都公用的身体&lt;/p&gt;"
                  + "{/block}"
                + "&lt;h1&gt;共用脚&lt;/h1&gt;");

var app = '{#extend base}'
        + '{#block body}'
        + '&lt;p&gt;你自己的身体&lt;/p&gt;'
        + '{/block}';

var temple;
temple = Temple.compile(app);
temple.render();
// =&gt; "&lt;h1&gt;共用头&lt;/h1&gt;&lt;p&gt;你自己的身体&lt;/p&gt;&lt;h1&gt;共用脚&lt;/h1&gt;"
</code></pre>

<h4 id="custom_function">custom function</h4>
<pre><code class="javascript">
Temple.reg("myescape",function(s){
  return escape(s);
});
var temple  = Temple.compile('{myescape(htmlstr)}');
temple.render({htmlstr:"&lt;p&gt;foo&lt;/p&gt;"});
// => "%3Cp%3Efoo%3C/p%3E"
</code></pre>

<h4 id="comment">comment</h4>
<pre><code class="javascript">
var temple;
temple  = Temple.compile('{#!this is a line of comment}');
temple.render();
// => ""

temple  = Temple.compile('{#! 可以包含"{"、"#"、"\\}" }');
temple.render();
// => ""

temple  = Temple.compile('{#! 中文注释} 中文字符串abc');
temple.render();
// => " 中文字符串abc"
</code></pre>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://tomycat.github.io/2014/07/19/2013-10-27-temple-intro/" data-id="ntqmwcnhi81c87q7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2013-10-26-jekyll-hilightjs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/19/2013-10-26-jekyll-hilightjs/" class="article-date">
  <time datetime="2014-07-19T12:18:44.000Z" itemprop="datePublished">7月 19 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p>layout: default<br>tags : other<br>comments : true<br>codesyntax : true</p>
<h2 id="-_other">- other</h2>
<h2 id="源码">源码</h2>
<pre><code class="javascript">
function hi(){
  alert("hi , world");
}
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://tomycat.github.io/2014/07/19/2013-10-26-jekyll-hilightjs/" data-id="hqhz0mxyuw0em46g" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="default-2013-10-26-md-syntax" class="article article-type-default" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/19/2013-10-26-md-syntax/" class="article-date">
  <time datetime="2014-07-19T12:18:44.000Z" itemprop="datePublished">7月 19 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="语法">语法</h2>
<p><a href="http://daringfireball.net/projects/markdown/syntax" target="_blank" rel="external">daringfireball</a></p>
<h2 id="footnote语法">footnote语法</h2>
<p>只有phpmarkdown支持</p>
<pre><code class="markdown">
That's some text with a footnote.[^1]

[^1]: And that's the footnote.
</code></pre>

<h2 id="table">table</h2>
<pre><code class="markdown">| 项目        | 价格   |  数量  |
| --------   | -----:  | :----:  |
| 计算机     | $1600 |   5     |
| 手机        |   $12   |   12   |
| 管线        |    $1    |  234  |
</code></pre>


<h2 id="链接复用">链接复用</h2>
<p>I get 10 times more traffic from <a href="http://google.com/" title="Google" target="_blank" rel="external">Google</a> than from<br><a href="http://search.yahoo.com/" title="Yahoo Search" target="_blank" rel="external">Yahoo</a> or <a href="http://search.msn.com/" title="MSN Search" target="_blank" rel="external">MSN</a>.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://tomycat.github.io/2014/07/19/2013-10-26-md-syntax/" data-id="lku2o2md7hkza3ij" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/other/">other</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="default-2014-07-19-learning-clojure-company" class="article article-type-default" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/19/2014-07-19-learning-clojure-company/" class="article-date">
  <time datetime="2014-07-19T12:18:44.000Z" itemprop="datePublished">7月 19 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/19/2014-07-19-learning-clojure-company/">Clojure 的发展情况</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>Clojure 是 Lisp 对 JVM 的抱大腿行为</blockquote>

<p>我猜，由于 Clojure 是 Lisp 方言的原因，在国内，Clojure 的使用真的很少很少，<a href="https://groups.google.com/forum/#!forum/cn-clojure" target="_blank" rel="external">cn-clojure</a> 这个国内的 Clojure 用户组的人气也不高。</p>
<p>于是，我提了一个问题， <a href="https://groups.google.com/forum/#!topic/cn-clojure/V03N0qJQ6_w" target="_blank" rel="external">Clojure的发展情况如何？</a> ，也做了些查询，汇总下信息</p>
<h3 id="国内使用_Clojure_的公司">国内使用 Clojure 的公司</h3>
<ol>
<li>一个比较大的公司是 <a href="https://www.avoscloud.com/" target="_blank" rel="external">AVOS</a>  ，是前 Youtube 创始人的公司，后端基本都是用 Clojure 来写的。</li>
<li><a href="https://www.zrcaifu.com/" target="_blank" rel="external">中瑞财富</a>  p2p 互联网金融项目</li>
<li><a href="http://rd.kuaijianli.com/u102510" target="_blank" rel="external">百思</a> 一个社交网站数据分析的公司</li>
<li>深圳风林火山 - 一家游戏公司：深圳风林火山，游戏产品黄金岛牌类游戏，目前使用 Clojure 作为主力服 务器开发语言。我们目前使用的 Clojure 技术都在刀锋上，非常前卫。使用 ClojureScript 和 Clojure 结合的开发框架目前正在产品化中，其中使用到的 ClojureScript 和 One 的新特性由 Clojure Core 团队开发，使用 Datomic 数据库。 我们的项目在第一次 ClojureConj 大会上作为 Aaron Bedra 介绍的 Clojure in the Field (Clojure 用于实战)的重要项目介绍。</li>
<li><a href="http://zbdang.com/" target="_blank" rel="external">直播贴</a> 一家八卦网站，也 <a href="https://groups.google.com/forum/#!searchin/cn-clojure/%E6%8B%9B%E8%81%98/cn-clojure/c7GU9Q9X6ck/ADNvCr-X_pMJ" target="_blank" rel="external">正在招人</a></li>
</ol>
<h3 id="金融系统">金融系统</h3>
<p>Clojure 的很多代码都是银行的业务作为例子，比如下面这个，所以以为会有比较多的金融行业应用，但是实际上没看到。。。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="list">(<span class="title">def</span> account<span class="number">1</span> <span class="list">(<span class="title">ref</span> <span class="number">100</span>)</span>)</span></div><div class="line"><span class="list">(<span class="title">def</span> account<span class="number">2</span> <span class="list">(<span class="title">ref</span> <span class="number">0</span>)</span>)</span></div><div class="line"></div><div class="line"><span class="comment">;; ; to read the current value of a ref, use (deref refname):</span></div><div class="line"><span class="comment">;; ;=&gt; (deref account1)</span></div><div class="line"><span class="comment">;; 100</span></div><div class="line"><span class="comment">;; ;=&gt; @account1 ; @refname is equivalent to (deref refname)</span></div><div class="line"><span class="comment">;; 100</span></div><div class="line"></div><div class="line"><span class="list">(<span class="title">defn</span> transfer [amount from to]</span></div><div class="line">  <span class="list">(<span class="title">dosync</span></span></div><div class="line">   <span class="list">(<span class="title">alter</span> from - amount)</span>   <span class="comment">; alter from =&gt; (- @from amount)</span></div><div class="line">   <span class="list">(<span class="title">alter</span> to   + amount)</span>)) <span class="comment">; alter to   =&gt; (+ @to amount)</span></div><div class="line"></div><div class="line"><span class="comment">;; ;=&gt; @account1</span></div><div class="line"><span class="comment">;; 100</span></div><div class="line"><span class="comment">;; ;=&gt; @account2</span></div><div class="line"><span class="comment">;; 0</span></div><div class="line"><span class="comment">;; ;=&gt; (transfer 100 account1 account2)</span></div><div class="line"><span class="comment">;; 100</span></div><div class="line"><span class="comment">;; ;=&gt; @account1</span></div><div class="line"><span class="comment">;; 0</span></div><div class="line"><span class="comment">;; ;=&gt; @account2</span></div><div class="line"><span class="comment">;; 100</span></div></pre></td></tr></table></figure><br>这个例子中，应用了 Clojure 的 STM 机制保证转账操作能都完毕，参见 [1]<br><br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="list">(<span class="title"><span class="built_in">alter</span></span> from - amount)</span></div><div class="line"><span class="list">(<span class="title"><span class="built_in">alter</span></span> to   + amount)</span></div></pre></td></tr></table></figure>

<p>搜索了下国外的情况，其实应用也不多，有 citi （花旗银行）、 UBS （瑞士联合银行） ，但是好像实际用的也不多。有一段评价[2]：</p>
<blockquote><br>Based on my own experience and conversations with others who work in the City, there’s a small but increasing move towards functional languages. I have to say that by far the most common I’ve heard of are Scala or F#, with ML and Clojure far behind.<br></blockquote>

<p>也就是说金融行业虽然也在往函数式语言靠，但是F# 和 Scala 的使用更广泛，远高于 ML 和 Clojure 这样的语言。</p>
<h3 id="Clojure_语言本身的发展情况">Clojure 语言本身的发展情况</h3>
<ol>
<li>特性变化还是挺多的，版本更新时，有 core.* 下面的更新</li>
<li>库变更也比较频繁：我目前借的两本书，《Clojure 编程》 和 《Clojure 程序设计》，内容都稍微有点过时，导致有些例子不能运行</li>
<li>语法发展也可以看下 <a href="https://groups.google.com/forum/#!topic/cn-clojure/V03N0qJQ6_w" target="_blank" rel="external">这个帖子</a> ，dennis zhuang 的回复，他本人就是在 AVOS 工作</li>
</ol>
<h4 id="REFS">REFS</h4>
<p>[1] <a href="http://chaifeng.com/clojure-stm-what-why-how/" target="_blank" rel="external">http://chaifeng.com/clojure-stm-what-why-how/</a></p>
<p>[2] <a href="http://mdavey.wordpress.com/2013/05/24/clojure-in-finance/" target="_blank" rel="external">http://mdavey.wordpress.com/2013/05/24/clojure-in-finance/</a> 的评论</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://tomycat.github.io/2014/07/19/2014-07-19-learning-clojure-company/" data-id="ff2oywmnnl2u2t19" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/clojure/">clojure</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="default-2014-07-16-learning-clojure-3" class="article article-type-default" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/19/2014-07-16-learning-clojure-3/" class="article-date">
  <time datetime="2014-07-19T12:18:44.000Z" itemprop="datePublished">7月 19 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/19/2014-07-16-learning-clojure-3/">学习 clojure 3 ：《Clojure程序设计》 Clojure 编程入门 - 在 repl 中测试代码</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="继续探索_repl">继续探索 repl</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">; CIDER 0.7.0alpha (package: 20140711.835) (Java 1.7.0_55, Clojure 1.5.1, nREPL 0.2.3, cider-nrepl 0.7.0-snapshot)</span></div><div class="line">user&gt; (defn hello [name] </div><div class="line">        (str <span class="string">"Hello, "</span> name)) <span class="comment">;; str 将列表转为字符串</span></div><div class="line"><span class="preprocessor">#'user/hello</span></div><div class="line">user&gt; (hello <span class="string">"tom"</span>)</div><div class="line"><span class="string">"Hello, tom"</span></div><div class="line">user&gt; *<span class="number">1</span> <span class="comment">; *1 *2 *3 分别存储了 repl 的最近3次求职</span></div><div class="line"><span class="string">"Hello, tom"</span></div><div class="line">user&gt; (/ <span class="number">1</span> <span class="number">0</span>) <span class="comment">;; 0 是不能作为分母的，会报错</span></div><div class="line">ArithmeticException Divide by zero  clojure<span class="preprocessor">.lang</span><span class="preprocessor">.Numbers</span><span class="preprocessor">.divide</span> (Numbers<span class="preprocessor">.java</span>:<span class="number">156</span>)</div><div class="line">user&gt; <span class="comment">;; *e 存储了最后一个异常的的信息</span></div><div class="line">user&gt; *e</div><div class="line"><span class="preprocessor">#&lt;ArithmeticException java.lang.ArithmeticException: Divide by zero&gt;</span></div><div class="line">user&gt; (pst) <span class="comment">;; print stacktrace 得到堆栈信息 </span></div><div class="line">CompilerException java<span class="preprocessor">.lang</span><span class="preprocessor">.RuntimeException</span>: Unable to resolve symbol: pst <span class="keyword">in</span> this context, compiling:(/private/var/folders/nt/gkh1mbhn4pncwb79gmrfr9740000gn/T/form-init5253497584462403679<span class="preprocessor">.clj</span>:<span class="number">1</span>:<span class="number">1</span>) </div><div class="line"></div><div class="line">user&gt; <span class="comment">;; 额，好像 pst 这个函数不存在了：1.3.0 之后，pst 放到 clojure.repl/pst 了，需要引入 (use 'clojure.repl)，见后面</span></div><div class="line"></div><div class="line">user&gt; (load-file <span class="string">"tmp.clj"</span>) <span class="comment">;; 加载 tmp.clj ，里面的定义会导入 到 user 命名空间下来 : (def a 1)</span></div><div class="line"><span class="preprocessor">#'user/a</span></div><div class="line">user&gt; a <span class="comment">;;</span></div><div class="line"><span class="number">1</span></div></pre></td></tr></table></figure>

<h3 id="查找文档">查找文档</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">user&gt; (use '[clojure.repl :only (doc)]) ;; 从 coljure.repl 中导入 doc </div><div class="line"></div><div class="line">nil</div><div class="line">user&gt; (doc str)                         ;; 使用 doc 来查找函数的文档</div><div class="line"><span class="comment">-------------------------</span></div><div class="line">clojure.core/str</div><div class="line">([] [x] [x & ys])</div><div class="line">  With no args, returns <span class="keyword">the</span> empty <span class="type">string</span>. With one arg x, returns</div><div class="line">  x.toString().  (str nil) returns <span class="keyword">the</span> empty <span class="type">string</span>. With more than</div><div class="line">  one arg, returns <span class="keyword">the</span> concatenation <span class="keyword">of</span> <span class="keyword">the</span> str values <span class="keyword">of</span> <span class="keyword">the</span> args.</div><div class="line">nil</div><div class="line"></div><div class="line">user&gt; (use '[clojure.repl :only (find-doc)])</div><div class="line">nil</div><div class="line">user&gt; (find-doc <span class="string">"reduce"</span>) ;; 在导入一个 find-doc 函数，支持正则或者字符串查找</div><div class="line"><span class="comment">-------------------------</span></div><div class="line">clojure.core/areduce</div><div class="line">([a idx ret init expr])</div><div class="line">Macro</div><div class="line">  Reduces an expression across an array a, using an index named idx,</div><div class="line">  <span class="keyword">and</span> <span class="constant">return</span> value named ret, initialized <span class="keyword">to</span> init, setting ret <span class="keyword">to</span> <span class="keyword">the</span> </div><div class="line">  evaluation <span class="keyword">of</span> expr <span class="keyword">at</span> each step, <span class="keyword">returning</span> ret.</div><div class="line"><span class="comment">-------------------------</span></div><div class="line">clojure.core/reduce</div><div class="line">([f coll] [f val coll])</div><div class="line">  f should be a function <span class="keyword">of</span> <span class="number">2</span> arguments. If val <span class="keyword">is</span> <span class="keyword">not</span> supplied,</div><div class="line">  returns <span class="keyword">the</span> <span class="constant">result</span> <span class="keyword">of</span> applying f <span class="keyword">to</span> <span class="keyword">the</span> <span class="keyword">first</span> <span class="number">2</span> items <span class="keyword">in</span> coll, <span class="keyword">then</span></div><div class="line">...</div></pre></td></tr></table></figure>



<h3 id="查看函数源码">查看函数源码</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">user&gt; (<span class="keyword">use</span> '[clojure.repl :only (source)])</div><div class="line">nil</div><div class="line">user&gt; (source identity)</div><div class="line">(defn identity</div><div class="line">  <span class="string">"Returns its argument."</span></div><div class="line">  {:added <span class="string">"1.0"</span></div><div class="line">   :<span class="keyword">static</span> <span class="keyword">true</span>}</div><div class="line">  [x] x)</div><div class="line">nil</div></pre></td></tr></table></figure>

<h3 id="修改用户配置文件，引入常用的工具函数">修改用户配置文件，引入常用的工具函数</h3>
<p>像上面的 <code>doc</code> 、<code>find</code> 等函数需要 <code>use</code> 才能使用，为方便起见，可以在repl启动时，就载入，只需在 <code>~/.lein/user.clj</code>  添加</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">;; 1.3.0 之后，将 doc source 等放到了 clojure.repl 中，可以在启动 repl时导入</span></div><div class="line"><span class="list">(<span class="title"><span class="built_in">if</span></span> <span class="list">(<span class="title">&gt;=</span> <span class="list">(<span class="title">.compareTo</span> <span class="list">(<span class="title">clojure-version</span>)</span> <span class="string">"1.3.0"</span>)</span><span class="number"> 0</span>)</span></span></div><div class="line">  <span class="list">(<span class="title"><span class="built_in">do</span></span> <span class="list">(<span class="title"><span class="built_in">use</span></span> 'clojure.repl)</span></span></div><div class="line">      <span class="list">(<span class="title"><span class="built_in">use</span></span> 'clojure.java.javadoc)</span>))</div></pre></td></tr></table></figure>

<p>这样，每次启动 repl 都能直接使用这些函数了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://tomycat.github.io/2014/07/19/2014-07-16-learning-clojure-3/" data-id="0yocrswhviwhehe0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/clojure/">clojure</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="default-2014-07-15-learning-clojure-2" class="article article-type-default" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/19/2014-07-15-learning-clojure-2/" class="article-date">
  <time datetime="2014-07-19T12:18:44.000Z" itemprop="datePublished">7月 19 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/19/2014-07-15-learning-clojure-2/">学习 clojure 2 ： 《Clojure程序设计》 Clojure 简介</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>Clojure 是一种基于 Java 虚拟机 （Java Virtual Machine）的动态编程语言，支持函数式编程，简化并发编程，能调用 Java 程序</blockquote>

<p>什么函数式编程？程序的功能单位是无副作用的函数，输入确定，输出就确定，就像数学上的函数一样。</p>
<p>相对传统的面向对象方式——复杂的对象关系图，基于状态变量，函数式编程提供了另外一种解决问题的思路。</p>
<h3 id="示例：使用_use_和_require_引入非核心库">示例：使用 <code>use</code> 和 <code>require</code> 引入非核心库</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">; CIDER <span class="number">0.7</span><span class="number">.0</span>alpha (<span class="keyword">package</span>: <span class="number">20140711.835</span>) (Java <span class="number">1.7</span><span class="number">.0</span>_55, Clojure <span class="number">1.5</span><span class="number">.1</span>, nREPL <span class="number">0.2</span><span class="number">.3</span>, cider-nrepl <span class="number">0.7</span><span class="number">.0</span>-snapshot)</div><div class="line">user&gt; (<span class="keyword">use</span> '[clojure.java.io :only (<span class="keyword">file</span>)])</div><div class="line">nil</div><div class="line">user&gt; (<span class="keyword">file</span> <span class="string">"README.md"</span>)</div><div class="line">#&lt;<span class="keyword">File</span> README.md&gt;</div><div class="line">user&gt; (require '[clojure.java.io :as io])</div><div class="line">nil</div><div class="line">user&gt; (io/<span class="keyword">file</span> <span class="string">"README.md"</span>)</div><div class="line">#&lt;<span class="keyword">File</span> README.md&gt;</div><div class="line">user&gt; ;; user&gt; 标明了当前所在的 Clojure 名字空间</div></pre></td></tr></table></figure>

<h3 id="示例：短小简洁的函数式风格代码">示例：短小简洁的函数式风格代码</h3>
<p>一个判断是否是空字符串的函数</p>
<p><strong>用Java 来写：</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringUtils</span> {</span></div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> isBlank(String <span class="keyword">str</span>){</div><div class="line">    <span class="keyword">int</span> strLen;</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">str</span> == <span class="keyword">null</span> || (strLen = <span class="keyword">str</span>.length()) == <span class="number">0</span>){</div><div class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; strLen;i++){</div><div class="line">      <span class="keyword">if</span>((Character.isWhiespace(<span class="keyword">str</span>.charAt(i)) == <span class="keyword">false</span>)){</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">      }</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">  }</div><div class="line">}</div></pre></td></tr></table></figure>

<p><strong>用Clojure 来写：</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="list">(<span class="title"><span class="built_in">defn</span></span> blank? <span class="collection">[str]</span></span></div><div class="line">  <span class="list">(<span class="title">every?</span> #<span class="list">(<span class="title">Character/isWhitespace</span> %)</span> str)</span>)</div></pre></td></tr></table></figure>

<p>短小多了吧！</p>
<p>值得的注意的是，Clojure版本的代码，噪音非常低，而Java的看起来很啰嗦，使用了更多的语法关键词，如 <code>public</code> , <code>class</code> , <code>boolean</code> 等</p>
<p>与 Java 等其它 C 系的语言不同，Clojure 中 <code>?</code> 也是可以作为函数名字的，Lisp系的语法关键词要少，因此显得简单优雅，这种简单优雅，是因为 Lisp 语言的构成单位括号表达式所带来的，括号表达式对与很多人来说显得很怪异，不过习惯了，就会喜欢上括号表示的，特别是Emacs对括号表达式的支持非常好，有一个 <code>par-mode</code> 可以对括号表达式，进行非常快速高效的编辑变换。</p>
<p>上面 Clojure 代码中的的 every? 是接受两个参数，一个函数 <code>f</code> <code>#(Character/isWhitespace %)</code> 和一个 <code>c</code> - <code>collection</code> 做为参数，注意，以函数为参数是函数式语言的特性，函数是可以参数传递的。对于<code>collection</code>中的元素，本例中即是<code>str</code> ，<code>f</code> 作用于 <code>c</code> 的每一个元素，都返回为真的话，那么 <code>every?</code> 也返回为真。</p>
<h3 id="示例：defrecord">示例：<code>defrecord</code></h3>
<h4 id="创建_records">创建 <code>records</code></h4>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">user&gt; (defrecord Person [<span class="keyword">first</span>-<span class="property">name</span> <span class="keyword">last</span>-<span class="property">name</span>])</div><div class="line">user.Person</div><div class="line">user&gt; (def foo (-&gt;Person <span class="string">"Jinwei"</span> <span class="string">"Tang"</span>))</div><div class="line"><span class="comment">#'user/foo</span></div><div class="line">user&gt; foo</div><div class="line"><span class="comment">#user.Person{:first-name "Jinwei", :last-name "Tang"}</span></div><div class="line">user&gt; (:<span class="keyword">first</span>-<span class="property">name</span> foo) ;; 访问</div><div class="line"><span class="string">"Jinwei"</span></div><div class="line">user&gt; (:<span class="keyword">last</span>-<span class="property">name</span> foo)</div><div class="line"><span class="string">"Tang"</span></div></pre></td></tr></table></figure>

<p>records 不可改变，records are immutable，但是可以通过 <code>assoc</code> 或者 <code>merge</code> 从原有的 records 创建新的 records</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">user<span class="subst">&gt;</span> (assoc foo :sex <span class="string">"male"</span>)</div><div class="line"><span class="variable">#user.Person</span>{:first<span class="attribute">-name</span> <span class="string">"Jinwei"</span>, :last<span class="attribute">-name</span> <span class="string">"Tang"</span>, :sex <span class="string">"male"</span>}</div><div class="line">user<span class="subst">&gt;</span> foo                       ;; 原来的 foo 不变</div><div class="line"><span class="variable">#user.Person</span>{:first<span class="attribute">-name</span> <span class="string">"Jinwei"</span>, :last<span class="attribute">-name</span> <span class="string">"Tang"</span>}</div><div class="line">user<span class="subst">&gt;</span> (merge foo {:sex <span class="string">"male"</span>}) ;; 也可以使用 merge 创建新的 <span class="keyword">records</span></div><div class="line"><span class="variable">#user.Person</span>{:first<span class="attribute">-name</span> <span class="string">"Jinwei"</span>, :last<span class="attribute">-name</span> <span class="string">"Tang"</span>, :sex <span class="string">"male"</span>}</div></pre></td></tr></table></figure>

<h4 id="创建带默认值的_record_[1]">创建带默认值的 <code>record</code> [1]</h4>
<p>(defrecord Foo [a b c])</p>
<p>(defn make-foo<br>  [&amp; {:keys [a b c] :or {a 5 c 7}}]<br>  (Foo. a b c))</p>
<p>(make-foo :b 6)<br>(make-foo :b 6 :a 8)</p>
<h4 id="什么时候使用_record">什么时候使用 record</h4>
<p>很多时候，<code>maps</code> 和 <code>structs</code> 即可完成大部分工作，可为什么还要使用 <code>record</code> 呢？ <a href="http://stackoverflow.com/questions/4575170/where-should-i-use-defrecord-in-clojure" target="_blank" rel="external">这里</a> 有介绍.</p>
<p><code>records</code> 就是 Java class instances (not Clojure maps)，具有更好的性能。</p>
<h3 id="Clojure_的一些特性">Clojure 的一些特性</h3>
<ol>
<li><p>参数的容器是一个向量 <code>[]</code> ，而不是列表 <code>()</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="list">(<span class="title"><span class="built_in">defn</span></span> hello-world <span class="collection">[user]</span></span></div><div class="line">  <span class="list">(<span class="title">println</span> <span class="list">(<span class="title"><span class="built_in">format</span></span> <span class="string">"Hello, %s"</span> user)</span>)</span>)</div></pre></td></tr></table></figure></li>
<li>相比Common Lisp简少了括号<br>Common Lisp<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="list">(<span class="title"><span class="built_in">cond</span></span> <span class="list">(<span class="list">(<span class="title"><span class="built_in">=</span></span> x<span class="number"> 10</span>)</span> <span class="string">"equal"</span>)</span></span></div><div class="line">       <span class="list">(<span class="list">(<span class="title">&gt;</span> x<span class="number"> 10</span>)</span> <span class="string">"more"</span>)</span>)</div></pre></td></tr></table></figure><br>Clojure<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="list">(<span class="title"><span class="built_in">cond</span></span> <span class="list">(<span class="title"><span class="built_in">=</span></span> x<span class="number"> 10</span>)</span> <span class="string">"equal"</span></span></div><div class="line">      <span class="list">(<span class="title">&gt;</span> x<span class="number"> 10</span>)</span> <span class="string">"more"</span>)</div></pre></td></tr></table></figure><h3 id="Clojure_中的并发编程示例：dosync">Clojure 中的并发编程示例：<code>dosync</code></h3>
</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">user&gt; (def accounts (<span class="keyword">ref</span> <span class="comment">#{}))</span></div><div class="line"><span class="comment">#'user/accounts</span></div><div class="line">user&gt; (defrecord Account [<span class="property">id</span> balance])</div><div class="line">user.Account</div><div class="line">user&gt; (dosync </div><div class="line">       (alter accounts conj (Account. <span class="string">"CLJ"</span> <span class="number">1000.00</span>)))</div><div class="line"><span class="comment">#{#user.Account{:id "CLJ", :balance 1000.0}}</span></div></pre></td></tr></table></figure>

<p><code>ref</code> 创建了一个引用，<code>dosync</code> 开启了一个事务，事务能不用Java的锁定机制来更新 <strong>可变数据</strong> 。事务使用了 (STM, software transactional memory) 来支持并发。</p>
<p><strong>什么是 STM 呢？</strong></p>
<blockquote><br>Software Transactional Memory (STM) is a concurrency control technique<br>analogous to database transactions for controlling access to shared<br>memory in concurrent computing. It is an alternative to lock based synchronization.<br></blockquote>

<p>STM 通过过 <code>ref</code> and <code>dosync</code> 来构建。如上面的例子所示。</p>
<p>上面的示例，可能不是特别好，可以看参考 [2] 的银行转账的示例 </p>
<h3 id="直接访问_Java_API">直接访问 Java API</h3>
<h3 id="访问_JavaAPI">访问 JavaAPI</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">user&gt; System</div><div class="line">java.lang.System</div><div class="line">user&gt; (System/getProperties)</div><div class="line">{<span class="string">"java.runtime.name"</span> <span class="string">"Java(TM) SE Runtime Environment"</span>, <span class="string">"sun...</span></div><div class="line">...many more...</div></pre></td></tr></table></figure>

<h3 id="Clojure_为访问_JavaAPI_提供了语法糖">Clojure 为访问 JavaAPI 提供了语法糖</h3>
<p>在 Java 中的方式：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">"hello"</span><span class="preprocessor">.getClass</span>()<span class="preprocessor">.getProtectionDomain</span>()</div></pre></td></tr></table></figure>

<p>Clojure 语法糖访问：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">user&gt; (.. <span class="string">"hello"</span> getClass getProtectionDomain)</div><div class="line"></div><div class="line"><span class="preprocessor">#&lt;ProtectionDomain ProtectionDomain  null</span></div><div class="line"> null</div><div class="line"> &lt;no principals&gt;</div><div class="line"> java<span class="preprocessor">.security</span><span class="preprocessor">.Permissions</span><span class="localvars">@7</span>e8027cd (</div><div class="line"> (<span class="string">"java.security.AllPermission"</span> <span class="string">"&lt;all permissions&gt;"</span> <span class="string">"&lt;all actions&gt;"</span>)</div><div class="line">)</div></pre></td></tr></table></figure>

<h3 id="Clojure_实现_Java_接口">Clojure 实现 Java 接口</h3>
<p>Clojure 提供了简单的函数用于实现 Java 接口，以及从 Java 基类派生。Clojure 的所有函数都实现了 Callable 和 Runnable 接口，下面使用匿名函数创建 Java 线程：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">user&gt; (.run (new <span class="keyword">Thread</span> (fn [] (println <span class="string">"Hello"</span> (<span class="keyword">Thread</span>/currentThread)))))</div><div class="line">Hello #&lt;<span class="keyword">Thread</span> <span class="keyword">Thread</span>[nREPL-worker-<span class="number">15</span>,<span class="number">5</span>,main]&gt;</div><div class="line">nil</div></pre></td></tr></table></figure>


<h3 id="REF">REF</h3>
<p>[1] <a href="http://stackoverflow.com/questions/5634188/how-to-set-default-values-for-fields-in-records-in-clojure" target="_blank" rel="external">http://stackoverflow.com/questions/5634188/how-to-set-default-values-for-fields-in-records-in-clojure</a></p>
<p>[2] <a href="http://sw1nn.com/blog/2012/04/11/clojure-stm-what-why-how/" target="_blank" rel="external">http://sw1nn.com/blog/2012/04/11/clojure-stm-what-why-how/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://tomycat.github.io/2014/07/19/2014-07-15-learning-clojure-2/" data-id="q3catm0f4apugy8f" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/clojure/">clojure</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2014-07-12-ios-dev-first-impression" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/19/2014-07-12-ios-dev-first-impression/" class="article-date">
  <time datetime="2014-07-19T12:18:44.000Z" itemprop="datePublished">7月 19 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p>layout: default<br>tags :<br>-cordova<br>-ios<br>comments : true</p>
<h2 id="title_:_iOS_开发的第一印象">title : iOS 开发的第一印象</h2>
<p>第一、贵 ，$99 刀换成人民币要 699 圆</p>
<p>第二、申请流程要填一大堆东西，还有各种申请，要登录各种系统，配置文件（Provisioning Profile） XCode 会代你生成，但是有些又要你自己申请</p>
<ol>
<li><p>Certificates xCode 会帮你生成，所以不用操心</p>
</li>
<li><p>Identifiers 需要自己申请，申请后，要等一段时间才能生效[3] ，并且注意和 iTunes connect 上的 bunddle id 要对应上</p>
</li>
<li><p>Provisioning Profiles 要自己生成</p>
</li>
</ol>
<p>第三、给开发者用的系统挺烂的：访问慢，提示在维护；在后台申请了一个 identities id，XCode 操作老是不成功，原来是这个id没有同步，上网一查，不是个案，要等一天左右才能同步</p>
<p>第四、开发完了打包发布，发现再怎么都不能 achive ，解决办法是，device不要选择模拟器</p>
<p>第五、发布时，不断的报错：choose a profile to sign with no identities were available，原因就是第三点里描述的，系统延迟！！而且还要延迟一天左右，见 <a href="http://stackoverflow.com/questions/10215530/no-identities-were-available-administrator-request" target="_blank" rel="external">ref</a></p>
<p>第六、使用 Webview 真的有点慢，在一个循环里面用了正则表达式测试，就把页面拖的卡死，但是我的这个应用又必须是网页的</p>
<p><strong>附录</strong></p>
<p>[1] <a href="http://docs.phonegap.com/en/edge/guide_platforms_ios_index.md.html" target="_blank" rel="external">http://docs.phonegap.com/en/edge/guide_platforms_ios_index.md.html</a></p>
<p>[2] <a href="http://stackoverflow.com/questions/12825724/applications-must-be-ready-for-upload-on-itunes-connect-before-they-can-be-valid" target="_blank" rel="external">http://stackoverflow.com/questions/12825724/applications-must-be-ready-for-upload-on-itunes-connect-before-they-can-be-valid</a></p>
<p>[3] <a href="http://anthonytietjen.blogspot.jp/2012/08/overcoming-trouble-validating-your.html" target="_blank" rel="external">http://anthonytietjen.blogspot.jp/2012/08/overcoming-trouble-validating-your.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://tomycat.github.io/2014/07/19/2014-07-12-ios-dev-first-impression/" data-id="cwwl3721f142t1i6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="default-2014-07-14-learning-clojure-1" class="article article-type-default" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/19/2014-07-14-learning-clojure-1/" class="article-date">
  <time datetime="2014-07-19T12:18:44.000Z" itemprop="datePublished">7月 19 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/19/2014-07-14-learning-clojure-1/">学习 clojure 1：缘起</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>想学 clojure 是因为看到一篇 blog ，在 pc 上支持 600k 的并发，太疯狂了，比 Node.js<br>的 250k 两倍还多，于是就心痒痒。并且 clojure 是 lisp 的方言，已知对 lisp 很有兴趣，<br>但是好像它被一些人人视为「玩具」——除非你特别牛，用它是找不到工作的。而clojure和<br>Java一样，是基于JVM的语言，所以它可以真的投入使用，比如 Storm 就是 clojure 的应用。</p>
<ol>
<li><p>clojure 的高并发能力</p>
<ul>
<li>因为它是 lock-free 的 [5]</li>
</ul>
</li>
<li><p>Mac 下安装lein<br>在已经有 Java 环境的情况下，安装非常简单：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew <span class="keyword">install</span> leiningen</div></pre></td></tr></table></figure>

<p>然后执行下面的命令，开启 repl</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lein repl</div></pre></td></tr></table></figure>
</li>
<li><p>环境搭建：Emacs+cider [4]</p>
<ul>
<li>M-x package-install [RET] cider [RET]</li>
<li><p>使用 lein 创建一个项目<br>lein new demo</p>
<p><img src="/blog/images/2014-07-14-learning-clure-1/0.png" alt="0.png"></p>
<p><img src="/blog/images/2014-07-14-learning-clure-1/1.png" alt="1.png"></p>
<p><img src="/blog/images/2014-07-14-learning-clure-1/2.png" alt="2.png"></p>
</li>
<li><p>用 Emacs 打开 demo/src/demo/core.clj，执行 M-x cider-jack-in （或使用快捷键 C-c M-j ）开启 nREPL server 以及 Emacs client ，这样就可以在 Emacs 中和后台的 server 交互了<br>如果出现如下的报错：ider-jack-in can’t find cider-nrepl</p>
<p>添加一个文件 ~/.lein/profiles.clj</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">{:user {:plugins <span class="string">[[cider/cider-nrepl "0.7.0-SNAPSHOT"]]</span>}}</div></pre></td></tr></table></figure>
</li>
<li><p>在编辑器中测试代码：在 demo/src/demo/core.clj 里面</p>
<ul>
<li>C-x C-e 移动光标到s-exp括号后面，就是是执行这个表达式</li>
<li><p>注意在执行 (foo “hello”) 之前，要执行前面的两个表达式</p>
<p><img src="/blog/images/2014-07-14-learning-clure-1/3.png" alt="3.png"></p>
</li>
</ul>
</li>
<li><p>在repl中执行代码</p>
<p><img src="/blog/images/2014-07-14-learning-clure-1/4.png" alt="4.png"></p>
</li>
<li><p>使用 lein 在 termial 中执行代码 </p>
<p><img src="/blog/images/2014-07-14-learning-clure-1/5.png" alt="5.png"></p>
<p>可以看到，缺少 main 函数，修改下代码</p>
<p><img src="/blog/images/2014-07-14-learning-clure-1/6.png" alt="6.png"></p>
<p>也可以指定为其它的函数为入口函数</p>
<p><img src="/blog/images/2014-07-14-learning-clure-1/7.png" alt="7.png"></p>
</li>
<li><p>project.clj 的所有配置项目见 <a href="https://github.com/technomancy/leiningen/blob/stable/sample.project.clj" target="_blank" rel="external">https://github.com/technomancy/leiningen/blob/stable/sample.project.clj</a></p>
</li>
<li>Emacs 的快捷键见 <a href="https://github.com/clojure-emacs/cider" target="_blank" rel="external">https://github.com/clojure-emacs/cider</a> cider-mode Keyboard shortcut</li>
</ul>
</li>
<li><p>学习 learning 需要 Java 的经验吗？[1]</p>
<ul>
<li>clojure 是lisp的方言，和Java很不相同，所以从语言角度来说，不需要</li>
<li><p>使用已经存在的Java API，那必须还是要和Java打交道</p>
<p>You don’t need to write any Java code to use Java APIs from Clojure, but you do need to know enough Java (method signatures, data types etc.) to be able to read the JavaDoc documentation of the APIs and convert this into an appropriate Clojure function call. Often, this is as simple as (.someJavaMethod someJavaObject param1 param2) but sometimes it can be more complex (e.g. when you need to instantiate a subclass of some Java class to pass as a parameter)</p>
</li>
<li><p>clojure 是最终会编译为JVM字节码，所以精通Java，应该是有好处的</p>
</li>
</ul>
</li>
<li><p>在哪里寻找第三方的库？</p>
<ul>
<li>clojure-contrib [8] </li>
<li>leiningen [9]</li>
</ul>
</li>
<li><p>clojure 的中小项目[2]</p>
<ul>
<li>cow-blog [7]</li>
<li>使用 lein 构建一个web应用 guest-book</li>
</ul>
</li>
<li><p>甚至有一个 clojure-android 的项目，可以让你在 android 上使用 clojure [6]</p>
<p>但是这时一个 hobby project ，性能很成问题</p>
</li>
</ol>
<h3 id="Footnotes">Footnotes</h3>
<p>[1] <a href="http://stackoverflow.com/questions/5721496/learning-java-so-i-can-get-at-clojure" target="_blank" rel="external">http://stackoverflow.com/questions/5721496/learning-java-so-i-can-get-at-clojure</a></p>
<p>[2] <a href="http://stackoverflow.com/questions/329221/medium-size-clojure-sample-application" target="_blank" rel="external">http://stackoverflow.com/questions/329221/medium-size-clojure-sample-application</a></p>
<p>[3] <a href="http://dev.clojure.org/display/community/Clojure%2BSuccess%2BStories" target="_blank" rel="external">http://dev.clojure.org/display/community/Clojure%2BSuccess%2BStories</a></p>
<p>[4] <a href="https://github.com/clojure-emacs/cider" target="_blank" rel="external">https://github.com/clojure-emacs/cider</a></p>
<p>[5] <a href="http://stackoverflow.com/questions/11031886/is-clojure-lockfree-by-using-lockfree-algorithms" target="_blank" rel="external">http://stackoverflow.com/questions/11031886/is-clojure-lockfree-by-using-lockfree-algorithms</a></p>
<p>[6] <a href="http://clojure-android.info/" target="_blank" rel="external">http://clojure-android.info/</a></p>
<p>[7] <a href="https://github.com/briancarper/cow-blog" target="_blank" rel="external">https://github.com/briancarper/cow-blog</a></p>
<p>[8] <a href="http://github.com/richhickey/clojure-contrib" target="_blank" rel="external">http://github.com/richhickey/clojure-contrib</a></p>
<p>[9] <a href="http://zef.me/2470/building-clojure-projects-with-leiningen" target="_blank" rel="external">http://zef.me/2470/building-clojure-projects-with-leiningen</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://tomycat.github.io/2014/07/19/2014-07-14-learning-clojure-1/" data-id="3pyujke78x5ec4s0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/clojure/">clojure</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="default-2014-07-10-cordova-generator" class="article article-type-default" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/19/2014-07-10-cordova-generator/" class="article-date">
  <time datetime="2014-07-19T12:18:44.000Z" itemprop="datePublished">7月 19 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/19/2014-07-10-cordova-generator/">cordova icon generator</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>cordova/phonegap 能实现跨平台，在各个平台下有不同的 icon、land screen，作为独立开发者，没有设计师，一切都自己搞的人来说，要做那么多套 icon 和 land screen 真是一件悲痛的事情。仅仅就 iOS 和 android 而言，都要生成这么多的图标，下面这还仅仅是iOS 的：</p>
<p><img src="/blog/images/2014-07-10-cordova-generator/1_c.png" alt="pic"></p>
<p><img src="/blog/images/2014-07-10-cordova-generator/2_c.png" alt="pic"></p>
<p><img src="/blog/images/2014-07-10-cordova-generator/3_c.png" alt="pic"></p>
<p>于是，写了个工具，从一张大图片直接生成所有的 icon 、land screen ，放到了 <a href="https://github.com/WeweTom/cordova-gen" target="_blank" rel="external">github 上</a> ，</p>
<p><strong>注意：</strong> 依赖 ImageMagic 的 convert 命令</p>
<ol>
<li>在 Mac 下 安装 <code>brew install imagemagick</code></li>
<li>linux (Ubuntu) 下 <code>apt-get install imagemagick</code></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://tomycat.github.io/2014/07/19/2014-07-10-cordova-generator/" data-id="8uwh6x8sv6eqfcff" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cordova/">cordova</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/archives/2014/page/2/">2</a><a class="page-number" href="/archives/2014/page/3/">3</a><a class="extend next" rel="next" href="/archives/2014/page/2/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/clojure/">clojure</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cordova/">cordova</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/life/">life</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/other/">other</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phonegap/">phonegap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/startup/">startup</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/clojure/" style="font-size: 17.50px;">clojure</a><a href="/tags/cordova/" style="font-size: 15.00px;">cordova</a><a href="/tags/javascript/" style="font-size: 12.50px;">javascript</a><a href="/tags/life/" style="font-size: 12.50px;">life</a><a href="/tags/mongodb/" style="font-size: 10.00px;">mongodb</a><a href="/tags/other/" style="font-size: 20.00px;">other</a><a href="/tags/phonegap/" style="font-size: 10.00px;">phonegap</a><a href="/tags/startup/" style="font-size: 10.00px;">startup</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07">七月 2014</a><span class="archive-list-count">24</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2014/07/20/testmd/">test.md</a>
          </li>
        
          <li>
            <a href="/2014/07/19/2013-10-27-temple-intro/">前端模板引擎Temple简介</a>
          </li>
        
          <li>
            <a href="/2014/07/19/2013-10-26-jekyll-hilightjs/">(no title)</a>
          </li>
        
          <li>
            <a href="/2014/07/19/2013-10-26-md-syntax/">(no title)</a>
          </li>
        
          <li>
            <a href="/2014/07/19/2014-07-19-learning-clojure-company/">Clojure 的发展情况</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2014 Jinwei Tang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>